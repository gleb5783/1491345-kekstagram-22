(()=>{var e={57:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector(".img-upload__start input[type=file]"),n=document.querySelector(".img-upload__preview img");t.addEventListener("change",(()=>{const r=t.files[0],o=r.name.toLowerCase();if(e.some((e=>o.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{n.src=e.result})),e.readAsDataURL(r)}}))}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var c=t[r]={exports:{}};return e[r](c,c.exports,n),c.exports}(()=>{"use strict";const e=e=>"Escape"===e.key||"Esc"===e.key,t=document.querySelector(".social__comments-loader"),r=document.querySelector("#filter-discussed"),o=document.querySelector("#filter-random"),c=document.querySelector("#filter-default"),s=document.querySelector(".pictures"),l=document.querySelector(".big-picture"),i=document.querySelector("body"),d=document.querySelector(".social__comments"),a=l.querySelector(".big-picture__img img"),m=l.querySelector(".likes-count"),u=l.querySelector(".comment-start"),v=l.querySelector(".comments-count"),y=l.querySelector("#picture-cancel"),g=document.querySelector("#picture").content.querySelector(".picture"),p=document.createDocumentFragment(),S=e=>{const t=document.querySelector("#comment").content.querySelector(".social__comment"),n=document.createDocumentFragment();return e.forEach((e=>{const r=t.cloneNode(!0);r.querySelector("img").src=e.avatar,r.querySelector("img").alt=e.name,r.querySelector(".social__text").textContent=e.message,n.appendChild(r)})),n},L=(e,t)=>e.comments.length>t.comments.length?-1:1,h=()=>.5-Math.random(),_=e=>{document.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active"),e.target.classList.toggle("img-filters__button--active");const t=document.querySelectorAll(".picture");for(let e=1;e<=t.length;e++)s.lastChild.remove()},q=(e,n)=>{n>=e.comments.length?t.classList.add("hidden"):t.classList.remove("hidden")},f=n=>{n.forEach((n=>{const r=g.cloneNode(!0);r.querySelector(".picture__img").src=n.url,r.querySelector(".picture__comments").textContent=n.comments.length,r.querySelector(".picture__likes").textContent=n.likes,r.addEventListener("click",(()=>{let r=5;const o=()=>{l.classList.add("hidden"),i.classList.remove("modal-open"),t.removeEventListener("click",c),document.removeEventListener("keydown",s),y.removeEventListener("click",o)},c=()=>(d.innerHTML="",r+=5,d.appendChild(S(n.comments.slice(0,r))),r>n.comments.length?u.textContent=n.comments.length:u.textContent=r,q(n,r),r),s=n=>{e(n)&&(l.classList.add("hidden"),i.classList.remove("modal-open"),t.removeEventListener("click",c),y.removeEventListener("click",o))};y.addEventListener("click",o),t.addEventListener("click",c),document.addEventListener("keydown",s),l.classList.remove("hidden"),i.classList.add("modal-open"),a.src=n.url,u.textContent=5,r>=n.comments.length&&(u.textContent=n.comments.length),m.textContent=n.likes,v.textContent=n.comments.length,d.innerHTML="",q(n,r),d.appendChild(S(n.comments.slice(0,r)))})),p.appendChild(r)})),s.appendChild(p)},E=(e,t)=>{k(e,t)},k=window._.debounce(((e,t)=>{if(e.target===o){_(e);const n=t.slice().sort(h).slice(0,10);f(n)}if(e.target===c&&(_(e),f(t)),e.target===r){_(e);const n=t.slice().sort(L);f(n)}}),500),b=document.querySelector(".img-upload__preview img"),C=document.querySelector(".effect-level__slider"),x=document.querySelector(".effect-level__value"),w=document.querySelector(".img-upload__effect-level"),F=()=>{for(let e of b.classList)b.classList.remove(e)},$={none:{},chrome:{sliderSettings:{range:{min:0,max:1},start:1,step:.1},getFilterStyle:e=>`grayscale(${Number(e)})`},sepia:{sliderSettings:{range:{min:0,max:1},start:1,step:.1},getFilterStyle:e=>`sepia(${Number(e)})`},marvin:{sliderSettings:{range:{min:0,max:100},start:100,step:1},getFilterStyle:e=>`invert(${Number(e)}%)`},phobos:{sliderSettings:{range:{min:0,max:3},start:3,step:.1},getFilterStyle:e=>`blur(${Number(e)}px)`},heat:{sliderSettings:{range:{min:1,max:3},start:3,step:.1},getFilterStyle:e=>`brightness(${Number(e)})`}};window.noUiSlider.create(C,{range:{min:0,max:100},start:80,step:1,connect:"lower"});const V=document.querySelector("#error").content.querySelector(".error"),N=document.querySelector("#error").content.querySelector(".error__button"),j=document.querySelector("#success").content.querySelector(".success"),D=document.querySelector("main"),M=j.querySelector(".success__button"),T=document.querySelector(".img-filters"),U=t=>{e(t)&&j.remove()},H=t=>{e(t)&&V.remove()},O=e=>{e.preventDefault();const t=new FormData(e.target);fetch("https://22.javascript.pages.academy/kekstagram",{method:"POST",body:t}).then((e=>{e.ok?P():W()})).catch(W)},A=()=>{j.remove()},I=()=>{V.remove()},R=()=>{j.remove(),document.removeEventListener("keydown",U),document.removeEventListener("click",A),M.removeEventListener("click",R)},z=()=>{V.remove(),document.removeEventListener("click",I),document.removeEventListener("keydown",H),N.removeEventListener("click",z)},P=()=>{ue(),document.addEventListener("keydown",U),document.addEventListener("click",A),M.addEventListener("click",R),D.appendChild(j)},W=()=>{ue(),document.addEventListener("click",I),document.addEventListener("keydown",H),N.addEventListener("click",z),D.appendChild(V)};fetch("https://22.javascript.pages.academy/kekstagram/data").then((e=>e.json())).then((e=>{f(e),(e=>{c.addEventListener("click",(t=>{E(t,e)}))})(e),(e=>{o.addEventListener("click",(t=>{E(t,e)}))})(e),(e=>{r.addEventListener("click",(t=>{E(t,e)}))})(e)})).then((()=>{T.classList.remove("img-filters--inactive")})).catch((()=>{document.body.innerHTML="<div class=`error`><h1>Error</h1><span>Пожалуйста перезагрузите страницу</span></div>"}));const B=document.querySelector(".text__hashtags"),G=/^#[a-z0-9]+$/i,J=()=>{const e=B.value.toLowerCase().split(" ");let t=!0;for(let n of e)"#"!==n[0]?(B.setCustomValidity("Начни с #"),t=!1):n.length>20?(B.setCustomValidity("Максимальная длинна 20 символов"),t=!1):n.length<=1?(B.setCustomValidity("ХешТег не может состоять из одной #"),t=!1):G.test(n)||(B.setCustomValidity("Нельзя использовать специальные символы"),t=!1);var n;e.length>5?(B.setCustomValidity("Максимум 5 ХешТегов"),t=!1):(n=e).length>1&&function(e){return e.filter(((t,n)=>e.indexOf(t)!==n))}(n).length>0&&(B.setCustomValidity("Нельзя использовать одинаковые ХешТеги"),t=!1),!0===t&&B.setCustomValidity(""),B.reportValidity()},K=document.querySelector("#upload-select-image"),Q=document.querySelector("#effect-none"),X=document.querySelector(".img-upload__effect-level"),Y=document.querySelector(".img-upload__overlay"),Z=document.querySelector("#upload-cancel"),ee=document.querySelector("#upload-file"),te=document.querySelector(".scale__control--value"),ne=document.querySelector(".img-upload__preview img"),re=document.querySelector(".scale__control--smaller"),oe=document.querySelector(".text__hashtags"),ce=document.querySelector(".text__description"),se=document.querySelector(".scale__control--bigger"),le=t=>{e(t)&&document.activeElement!==oe&&document.activeElement!==ce&&ue()},ie=()=>{ue()},de=e=>{te.value=`${parseInt(te.value)+e}%`,ne.style.transform=`scale(${parseInt(te.value)/100})`},ae=()=>{de(25),re.disabled=!1,"100%"===te.value&&(se.disabled=!0)},me=()=>{de(-25),se.disabled=!1,"25%"===te.value&&(re.disabled=!0)};ee.addEventListener("change",(()=>{re.disabled=!1,se.disabled=!0,K.addEventListener("submit",O),oe.addEventListener("input",J),(()=>{for(let e in $){const t=()=>{F(),"none"===e?(x.value="",b.style.filter="",w.classList.add("hidden")):(w.classList.remove("hidden"),b.classList.add(`effects__preview--${e}`),C.noUiSlider.on("update",((t,n)=>{x.value=t[n],b.style.filter=$[e].getFilterStyle(x.value)})),C.noUiSlider.updateOptions($[e].sliderSettings))};document.querySelector(`#effect-${e}`).addEventListener("change",t)}})(),Y.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open"),re.addEventListener("click",me),se.addEventListener("click",ae),Z.addEventListener("click",ie),document.addEventListener("keydown",le)}));const ue=()=>{oe.removeEventListener("input",J),K.removeEventListener("submit",O),Q.checked=!0,X.classList.add("hidden"),Y.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"),ee.value="",ne.style.filter="none",re.removeEventListener("click",me),se.removeEventListener("click",ae),ne.style.transform="scale(1)",te.value="100%",document.removeEventListener("keydown",le),Z.removeEventListener("click",ie),oe.value="",ce.value=""};n(57)})()})();
//# sourceMappingURL=main.bundle.js.map